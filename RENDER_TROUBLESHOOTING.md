# üîß Render Deployment Troubleshooting Guide

## Common Build Failures and Solutions

### 1. "build.sh: command not found"

**Problem**: The build script cannot be found or executed.

**Solutions**:
1. **Use the updated render.yaml** with inline build commands:
   ```yaml
   buildCommand: |
     pip install -r requirements.txt
     python init_db.py
   ```

2. **Alternative: Use minimal build** (copy `render-minimal.yaml` to `render.yaml`):
   ```yaml
   buildCommand: pip install -r requirements.txt
   ```

### 2. Database Initialization Errors

**Problem**: Scripts fail during database setup.

**Solutions**:
1. **Use runtime initialization**: The updated `start.py` handles database setup on startup
2. **Manual setup**: Skip database initialization in build, set up manually after deployment
3. **Use PostgreSQL**: Add a PostgreSQL database in Render dashboard

### 3. Import Errors

**Problem**: Python modules cannot be imported.

**Solutions**:
1. **Check requirements.txt**: Ensure all dependencies are listed
2. **Python path issues**: Scripts now include proper path setup
3. **Module structure**: Verify all `__init__.py` files exist

### 4. Environment Variable Issues

**Problem**: Configuration not loading correctly.

**Solutions**:
1. **Set required variables** in Render dashboard:
   ```
   ENVIRONMENT=production
   DEBUG=false
   SECRET_KEY=<auto-generated>
   ALLOWED_HOSTS=<your-frontend-url>
   ```

2. **Database URL**: Use Render's auto-generated DATABASE_URL if using PostgreSQL

### 5. Static File Issues

**Problem**: Images not loading or upload directory errors.

**Solutions**:
1. **Create upload directory**: Render will create it automatically
2. **File permissions**: Render handles this automatically
3. **Static file serving**: Verify `/static` endpoint works

## Step-by-Step Deployment Fix

### Option 1: Quick Fix (Recommended)

1. **Update render.yaml** to use minimal build:
   ```bash
   cp backend/render-minimal.yaml backend/render.yaml
   ```

2. **Redeploy** in Render dashboard:
   - Go to your service
   - Click "Manual Deploy"
   - Select "Deploy latest commit"

3. **Manual setup** after deployment:
   - Visit `/docs` endpoint
   - Use API to create admin user if needed

### Option 2: Full Database Setup

1. **Add PostgreSQL database** in Render:
   - Create new PostgreSQL database
   - Connect to your web service
   - DATABASE_URL will be auto-set

2. **Use the enhanced start.py**:
   - Database initialization happens at startup
   - More resilient to errors
   - Automatic retry logic

### Option 3: Local Build Test

1. **Test locally** before deploying:
   ```bash
   cd backend
   pip install -r requirements.txt
   python init_db.py
   python start.py
   ```

2. **Fix any errors** locally first
3. **Commit and redeploy**

## Environment Variables Reference

### Required Variables:
```env
ENVIRONMENT=production
DEBUG=false
SECRET_KEY=<secure-random-string>
HOST=0.0.0.0
PORT=10000
```

### Optional Variables:
```env
DATABASE_URL=<auto-set-if-using-render-db>
ALLOWED_HOSTS=<your-frontend-url>
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
MAX_FILE_SIZE=10485760
UPLOAD_DIR=app/static/images
ALLOWED_EXTENSIONS=.jpg,.jpeg,.png,.gif,.webp
```

## Database Options

### Option 1: SQLite (Default)
- **Pros**: Simple, no additional setup
- **Cons**: Not persistent across deployments
- **Use case**: Testing, development

### Option 2: PostgreSQL (Recommended)
- **Pros**: Persistent, scalable, production-ready
- **Cons**: Requires additional service
- **Setup**: Add PostgreSQL database in Render dashboard

## Debugging Commands

### Check Service Status:
1. Go to Render dashboard
2. View service logs
3. Check environment variables
4. Test health check endpoint

### Test API Endpoints:
```bash
# Health check
curl https://your-api-url.onrender.com/docs

# Test basic endpoint
curl https://your-api-url.onrender.com/api/categories/

# Check static files
curl https://your-api-url.onrender.com/static/
```

### Common Log Messages:

**Success**:
```
‚úÖ Database tables verified
‚úÖ Admin user exists
üöÄ Starting Cheriyan Studio API on port 10000
```

**Warnings** (usually safe to ignore):
```
‚ö†Ô∏è  Database initialization warning: ...
üìù You may need to create admin user manually
```

**Errors** (need attention):
```
‚ùå Failed to connect to database
‚ùå Import error: ...
‚ùå Permission denied: ...
```

## Frontend Deployment Issues

### Build Failures:
1. **Check Node.js version**: Render uses Node 18 by default
2. **Dependencies**: Ensure `package-lock.json` is committed
3. **Build command**: Should be `npm ci && npm run build`

### Runtime Issues:
1. **API URL**: Set `VITE_API_URL` to your backend URL
2. **CORS errors**: Update backend `ALLOWED_HOSTS`
3. **Routing**: Ensure SPA routing is configured

## Support Resources

### Render Documentation:
- [Troubleshooting Deploys](https://render.com/docs/troubleshooting-deploys)
- [Python on Render](https://render.com/docs/deploy-fastapi)
- [Static Sites](https://render.com/docs/static-sites)

### Application Logs:
- Check Render dashboard logs
- Look for specific error messages
- Monitor startup sequence

### Community Support:
- Render Community Forum
- GitHub Issues
- Stack Overflow

## Quick Recovery Steps

If deployment fails completely:

1. **Revert to minimal config**:
   ```bash
   cp backend/render-minimal.yaml backend/render.yaml
   git add . && git commit -m "Use minimal render config"
   git push
   ```

2. **Manual redeploy** in Render dashboard

3. **Set up data manually** after successful deployment:
   - Use API endpoints to create admin user
   - Upload images through admin interface
   - Configure settings as needed

4. **Gradually add features** back once basic deployment works

Remember: It's better to have a working basic deployment than a failing complex one!
